{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <title>Transcendence</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="{% static 'js/bootstrap.bundle.min.js' %}"></script>
    <link href="{% static 'css/bootstrap.min.css' %}" rel="stylesheet">
</head>
<body>
    <nav class="navbar navbar-dark bg-dark" aria-label="First navbar example">
        <div class="container-fluid">
            <a class="navbar-brand" href="#" style="font-weight: 1000; font-size: xx-large;">Transcendence</a>
            <img id="navbar-image" src="{% static 'images/image.png' %}" alt="" style="width: 10%; height: 10%; border-radius: 100px 100px 100px 100px;" class="mx-auto">
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarsExample01" aria-controls="navbarsExample01" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
          </button>
    
          <div class="collapse navbar-collapse" id="navbarsExample01">
            <ul class="navbar-nav me-auto mb-2">
              <li class="nav-item">
                <a class="nav-link" href="" id="start-link">Home</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="" id="game-link">Game</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="" id="gameAI-link">GameAI</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="" id="tournament-link">Tournament</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="" id="game3D-link">Game3D</a>
              </li>
            <li class="nav-item">
              <a class="nav-link" href="" id="multiGame-link">Local Multiplayer</a>
            </li>
              <li class="nav-item">
                <a class="nav-link" href="" id="tac-link">Tic Tac Toe</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="" id="register-link">Register</a>           
                </li>
              <li class="nav-item">
                <a class="nav-link" href="" id="login-link">Login</a>
              </li>
            </ul>
          </div>
        </div>
      </nav>

      <div id="content">
        <!-- Content will be loaded here -->
      </div>

    <script>
        $(document).ready(function() {

function changeNavbarImage(imagePath) {
    $('#navbar-image').attr('src', imagePath);
}

function loadPageContent(page, addToHistory = true) {
    $.ajax({
        url: '/' + page + '/',
        method: 'GET',
        success: function(data) {
            $('#content').html(data);
            executeScripts($('#content'));
            if (addToHistory) {
                history.pushState({ page: page }, '', '/' + page + '/');
            }
        },
        error: function(jqXHR, textStatus, errorThrown) {
            console.error('Error loading page:', textStatus, errorThrown);
        }
    });
}

function loadPage(page, addToHistory = true) {
    $.ajax({
        url: '/' + page + '/',
        method: 'GET',
        success: function(data, textStatus, xhr) {
            if (xhr.getResponseHeader('Content-Type').includes('application/json')) {
                var jsonData = JSON.parse(data);
                if (jsonData.status == 'ok') {
                    loadPageContent(page, addToHistory);
                }
            } else {
                $('#content').html(data);
                executeScripts($('#content'));
                if (addToHistory) {
                    history.pushState({ page: page }, '', '/' + page + '/');
                }
            }
        },
        error: function(jqXHR, textStatus, errorThrown) {
            console.error('Error loading page:', textStatus, errorThrown);
        }
    });
}

function executeScripts(container) {
    container.find('script').each(function() {
        $.globalEval(this.text || this.textContent || this.innerHTML || '');
    });
}

function getImagePathForPage(page) {
    switch (page) {
        case 'start': return '{% static "images/image.png" %}';
        case 'tac': return '{% static "images/Tac.png" %}';
        case 'game': return '{% static "images/pong.png" %}';
        case 'gameAI': return '{% static "images/AI.png" %}';
        case 'tournament': return '{% static "images/tournament.png" %}';
        case 'game3D': return '{% static "images/3D.png" %}';
        case 'multiGame': return '{% static "images/friends.png" %}';
        default: return '{% static "images/image.png" %}';
    }
}

function initialLoad() {
    var path = window.location.pathname.split('/')[1] || 'start';
    changeNavbarImage(getImagePathForPage(path));
    loadPage(path, false);
}

$('body').on('click', '#start-link', function(e) {
  e.preventDefault();
    changeNavbarImage('{% static "images/image.png" %}');
    loadPage('start');
});
$('body').on('click', '#game-link', function(e) {
            e.preventDefault();
            changeNavbarImage('{% static "images/pong.png" %}');
            loadPage('game');
        });
$('body').on('click', '#gameAI-link', function(e) {
          e.preventDefault();
    changeNavbarImage('{% static "images/AI.png" %}');
    loadPage('gameAI');
});
$('body').on('click', '#tournament-link', function(e) {
  e.preventDefault();
    changeNavbarImage('{% static "images/tournament.png" %}');
    loadPage('tournament');
});
$('body').on('click', '#tac-link', function(e) {
  e.preventDefault();
    changeNavbarImage('{% static "images/Tac.png" %}');
    loadPage('tac');
});
$('body').on('click', '#game3D-link', function(e) {
  e.preventDefault();
    changeNavbarImage('{% static "images/3D.png" %}');
    loadPage('game3D');
});

$('body').on('click', '#multiGame-link', function(e) {
  e.preventDefault();
    changeNavbarImage('{% static "images/friends.png" %}');
    loadPage('multiGame');
});

$('body').on('click', '#login-link', function(e) {
  e.preventDefault();
    changeNavbarImage('{% static "images/friends.png" %}');
    loadPage('login');
});

$('body').on('click', '#register-link', function(e) {
  e.preventDefault();
    changeNavbarImage('{% static "images/friends.png" %}');
    loadPage('register');
});
$('#navbar a').click(function() {
    if (window.Game) {
        Game.finalize();
    }
});

initialLoad();

// Handle browser back/forward button
window.onpopstate = function(event) {
    if (event.state && event.state.page) {
        changeNavbarImage(getImagePathForPage(event.state.page));
        loadPage(event.state.page, false);
    }
};
});

const navLinks = document.querySelectorAll('.navbar-nav .nav-link');

// Add click event listener to each navbar link
navLinks.forEach(link => {
  link.addEventListener('click', () => {
    // Close the navbar collapse menu programmatically
    const navbarCollapse = document.getElementById('navbarsExample01');
    if (navbarCollapse.classList.contains('show')) {
      new bootstrap.Collapse(navbarCollapse).hide();
    }
  });
});
    </script>

</body>
</html>