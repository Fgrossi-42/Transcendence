{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Transcendence</title>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <link href="{% static 'css/bootstrap.min.css' %}" rel="stylesheet">
</head>
<body>
    <nav class="navbar navbar-dark bg-dark" aria-label="First navbar example">
        <div class="container-fluid">
            <a class="navbar-brand" href="#" style="font-weight: 1000; font-size: xx-large;">Transcendence</a>
            <img id="navbar-image" src="{% static 'images/image.png' %}" alt="" style="width: 10%; height: 10%; border-radius: 100px 100px 100px 100px;" class="mx-auto">
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarsExample01" aria-controls="navbarsExample01" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
          </button>
    
          <div class="collapse navbar-collapse" id="navbarsExample01">
            <ul class="navbar-nav me-auto mb-2">
              <li class="nav-item">
                <a class="nav-link" href="" id="start-link">Home</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="" id="game-link">game</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="" id="friends-link">Friends</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="" id="chat-link">Chat</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="" id="dashboard-link">Dashboard</a>
              </li>
            </ul>
          </div>
        </div>
      </nav>

      <div id="content">
        <!-- Content will be loaded here -->
      </div>

    <script>
        $(document).ready(function() {

function changeNavbarImage(imagePath) {
    $('#navbar-image').attr('src', imagePath);
}

function loadPage(page, addToHistory = true) {
    $.ajax({
        url: '/' + page + '/',  // Ensure the URL is absolute
        method: 'GET',
        success: function(data) {
            $('#content').html(data);
            initializeCollapse();
            executeScripts($('#content'));
            if (addToHistory) {
                history.pushState({ page: page }, '', '/' + page + '/');  // Ensure the URL is absolute
            }
        }
    });
}

function executeScripts(container) {
    container.find('script').each(function() {
        $.globalEval(this.text || this.textContent || this.innerHTML || '');
    });
}

function initializeCollapse() {
    var navbarToggler = document.querySelector('.navbar-toggler');
    var navbarCollapse = document.querySelector(navbarToggler.dataset.bsTarget);
    if (navbarToggler && navbarCollapse) {
        navbarToggler.addEventListener('click', function() {
            if (navbarCollapse.classList.contains('show')) {
                $(navbarCollapse).collapse('hide');
            } else {
                $(navbarCollapse).collapse('show');
            }
        });
    }
}

function getImagePathForPage(page) {
    switch (page) {
        case 'start': return '{% static "images/image.png" %}';
        case 'game': return '{% static "images/pong.png" %}';
        case 'chat': return '{% static "images/chat.png" %}';
        case 'dashboard': return '{% static "images/dashboard.png" %}';
        case 'friends': return '{% static "images/friends.png" %}';
        default: return '{% static "images/image.png" %}';
    }
}

function initialLoad() {
    var path = window.location.pathname.split('/')[1] || 'start';
    changeNavbarImage(getImagePathForPage(path));
    loadPage(path, false);
}

$('#start-link').click(function(e) {
    e.preventDefault();
    changeNavbarImage('{% static "images/image.png" %}');
    loadPage('start');
});
$('#game-link').click(function(e) {
    e.preventDefault();
    changeNavbarImage('{% static "images/pong.png" %}');
    loadPage('game');
});
$('#chat-link').click(function(e) {
    e.preventDefault();
    changeNavbarImage('{% static "images/chat.png" %}');
    loadPage('chat');
});
$('#dashboard-link').click(function(e) {
    e.preventDefault();
    changeNavbarImage('{% static "images/dashboard.png" %}');
    loadPage('dashboard');
});
$('#friends-link').click(function(e) {
    e.preventDefault();
    changeNavbarImage('{% static "images/friends.png" %}');
    loadPage('friends');
});

// Initial load based on the current URL
initialLoad();

// Handle browser back/forward button
window.onpopstate = function(event) {
    if (event.state && event.state.page) {
        changeNavbarImage(getImagePathForPage(event.state.page));
        loadPage(event.state.page, false);
    }
};
});

    </script>

    <script src="{% static 'js/bootstrap.bundle.min.js' %}"></script>
</body>
</html>